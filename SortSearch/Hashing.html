<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Хэширование &mdash; Problem Solving with Algorithms and Data Structures</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-3.0.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/video.css" type="text/css" />
    <link rel="stylesheet" href="../_static/poll.css" type="text/css" />
    <link rel="stylesheet" href="../_static/tabbedstuff.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/pytutor.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/codemirror.css" type="text/css" />
    <link rel="stylesheet" href="../_static/activecode.css" type="text/css" />
    <link rel="stylesheet" href="../_static/parsons.css" type="text/css" />
    <link rel="stylesheet" href="../_static/lib/prettify.css" type="text/css" />
    <link rel="stylesheet" href="../_static/jquery-ui-1.10.3.custom.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/user-highlights.css" type="text/css" />
    <link rel="stylesheet" href="../_static/runestone-custom-sphinx-bootstrap.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/poll.js"></script>
    <script type="text/javascript" src="../_static/js/d3.v2.min.js"></script>
    <script type="text/javascript" src="../_static/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery.ba-bbq.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery.jsPlumb-1.3.10-all-min.js"></script>
    <script type="text/javascript" src="../_static/js/pytutor.js"></script>
    <script type="text/javascript" src="../_static/jquery.highlight.js"></script>
    <script type="text/javascript" src="../_static/bookfuncs.js"></script>
    <script type="text/javascript" src="../_static/codemirror.js"></script>
    <script type="text/javascript" src="../_static/python.js"></script>
    <script type="text/javascript" src="../_static/javascript.js"></script>
    <script type="text/javascript" src="../_static/activecode.js"></script>
    <script type="text/javascript" src="../_static/skulpt.min.js"></script>
    <script type="text/javascript" src="../_static/skulpt-stdlib.js"></script>
    <script type="text/javascript" src="../_static/assess.js"></script>
    <script type="text/javascript" src="../_static/animationbase.js"></script>
    <script type="text/javascript" src="../_static/lib/jquery.min.js"></script>
    <script type="text/javascript" src="../_static/lib/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../_static/lib/prettify.js"></script>
    <script type="text/javascript" src="../_static/lib/underscore-min.js"></script>
    <script type="text/javascript" src="../_static/lib/lis.js"></script>
    <script type="text/javascript" src="../_static/parsons.js"></script>
    <script type="text/javascript" src="../_static/parsons-noconflict.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/jquery-ui-1.10.3.custom.min.js"></script>
    <script type="text/javascript" src="../_static/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <script type="text/javascript" src="../_static/waypoints.min.js"></script>
    <script type="text/javascript" src="../_static/rangy-core.js"></script>
    <script type="text/javascript" src="../_static/rangy-textrange.js"></script>
    <script type="text/javascript" src="../_static/rangy-cssclassapplier.js"></script>
    <script type="text/javascript" src="../_static/user-highlights.js"></script>
    <script type="text/javascript" src="../_static/jquery.idle-timer.js"></script>
    <script type="text/javascript" src="../_static/processing-1.4.1.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.hotkey.js"></script>
    <link rel="top" title="Problem Solving with Algorithms and Data Structures" href="../index.html" />
    <link rel="next" title="Пузырьковая сортировка" href="TheBubbleSort.html" />
    <link rel="prev" title="Бинарный поиск" href="TheBinarySearch.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
<script type="text/javascript">
  eBookConfig = {};
  eBookConfig.host = 'http://127.0.0.1:8000' ? 'http://127.0.0.1:8000' : 'http://127.0.0.1:8000';
  eBookConfig.app = eBookConfig.host+'/runestone';
  eBookConfig.ajaxURL = eBookConfig.app+'/ajax/';
  eBookConfig.course = 'pythonds';
  eBookConfig.logLevel = 10;
  eBookConfig.loginRequired = false
  eBookConfig.build_info = "2.1.5";
  eBookConfig.isLoggedIn = false;
</script>

<div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&status=0";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>


<script>
var _prum = [['id', '521dfcc4abe53d0749000000'],
             ['mark', 'firstbyte', (new Date()).getTime()]];
(function() {
    var s = document.getElementsByTagName('script')[0]
      , p = document.createElement('script');
    p.async = 'async';
    p.src = '//rum-static.pingdom.net/prum.min.js';
    s.parentNode.insertBefore(p, s);
})();
</script>



  </head>
  <body>


<!-- Begin navbar -->
<div id="navbar" class="navbar navbar-default navbar-fixed-top" role="navigation">

  <div class="container">

    <div class="navbar-header">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button type='button' class='navbar-toggle' data-toggle="collapse" data-target=".navbar-ex1-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div>
        <a class="brand-logo" style='background: transparent url("../_static/img/logo_small.png") no-repeat 0px 0px;' href="/runestone/default/user/login">&nbsp; </a>
        <a class="navbar-brand" href="../index.html">Problem Solving with Algorithms and Data Structures</a>
      </div>
    </div>

    <div class="navbar-collapse collapse navbar-ex1-collapse">

      <ul class="nav navbar-nav navbar-right">

        <li class="divider-vertical"></li>

        <!-- social media dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-share-alt" style="opacity: 0.9"></i>
          </a>
          <ul class="dropdown-menu social-menu">
              <li>
                <div>
                  <b>Runestone in social media:</b>
                </div>
                <a href="https://twitter.com/iRunestone" class="twitter-follow-button" data-show-count="true">Follow @iRunestone</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                <div class="fb-like" data-href="https://www.facebook.com/RunestoneInteractive" data-send="false" data-layout="button_count" data-width="300" data-show-faces="false" data-font="arial"></div>
              </li>

              <li class="divider"></li>
              <li>
                <div>
                  <b>Help support us:</b>
                </div>
                <div class="gittip">
                  <iframe style="border:0;"
                    src="https://www.gittip.com/bnmnetp/widget.html"
                    width="48pt" height="22pt" class="gittip-button">
                  </iframe>
                </div>
                <div>
                    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
                  <input type="hidden" name="cmd" value="_s-xclick">
                  <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----MIIHNwYJKoZIhvcNAQcEoIIHKDCCByQCAQExggEwMIIBLAIBADCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20CAQAwDQYJKoZIhvcNAQEBBQAEgYAcrkqh1hn3lYqIpfXxNqe1T82EhXzCJGy1yMAmklpyZshyMkfDGe1Bhx+iwyGeoYRTTyphFmP+9M3NyO0+Q5XdHxgZPx/zYjjBxlZHgEV6jhE8bN2fHkkPf0VHfz0a0QQylQOPlKiOTZV7B37Jpk6yM47oVZ1tG/KNm0NkfmB76DELMAkGBSsOAwIaBQAwgbQGCSqGSIb3DQEHATAUBggqhkiG9w0DBwQIi0GmFfOlcjuAgZBbYOo9UO+CpMQa+PYqwsUmUnJvXIImeMeNI3KVTUx5Cfk9gNMo3WzPeiB5IqZo9nRAQ0mf1qL2ecLeB5tidM+lgBUhOxfj3/FecpnVFa0263gp4g+PLw8jzhvVRdUon1K3SeO1Rzh23fIRKwnrD6btt73uwtj0sl3tGd8qz+6GIcwPDdRk9VcUffiBJT/ZagKgggOHMIIDgzCCAuygAwIBAgIBADANBgkqhkiG9w0BAQUFADCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20wHhcNMDQwMjEzMTAxMzE1WhcNMzUwMjEzMTAxMzE1WjCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAMFHTt38RMxLXJyO2SmS+Ndl72T7oKJ4u4uw+6awntALWh03PewmIJuzbALScsTS4sZoS1fKciBGoh11gIfHzylvkdNe/hJl66/RGqrj5rFb08sAABNTzDTiqqNpJeBsYs/c2aiGozptX2RlnBktH+SUNpAajW724Nv2Wvhif6sFAgMBAAGjge4wgeswHQYDVR0OBBYEFJaffLvGbxe9WT9S1wob7BDWZJRrMIG7BgNVHSMEgbMwgbCAFJaffLvGbxe9WT9S1wob7BDWZJRroYGUpIGRMIGOMQswCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDU1vdW50YWluIFZpZXcxFDASBgNVBAoTC1BheVBhbCBJbmMuMRMwEQYDVQQLFApsaXZlX2NlcnRzMREwDwYDVQQDFAhsaXZlX2FwaTEcMBoGCSqGSIb3DQEJARYNcmVAcGF5cGFsLmNvbYIBADAMBgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBBQUAA4GBAIFfOlaagFrl71+jq6OKidbWFSE+Q4FqROvdgIONth+8kSK//Y/4ihuE4Ymvzn5ceE3S/iBSQQMjyvb+s2TWbQYDwcp129OPIbD9epdr4tJOUNiSojw7BHwYRiPh58S1xGlFgHFXwrEBb3dgNbMUa+u4qectsMAXpVHnD9wIyfmHMYIBmjCCAZYCAQEwgZQwgY4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEWMBQGA1UEBxMNTW91bnRhaW4gVmlldzEUMBIGA1UEChMLUGF5UGFsIEluYy4xEzARBgNVBAsUCmxpdmVfY2VydHMxETAPBgNVBAMUCGxpdmVfYXBpMRwwGgYJKoZIhvcNAQkBFg1yZUBwYXlwYWwuY29tAgEAMAkGBSsOAwIaBQCgXTAYBgkqhkiG9w0BCQMxCwYJKoZIhvcNAQcBMBwGCSqGSIb3DQEJBTEPFw0xMzExMDMxMzQxMzFaMCMGCSqGSIb3DQEJBDEWBBRDJF8w+zsMr7FSk+pwinB5f5D4rzANBgkqhkiG9w0BAQEFAASBgHw1LMHpkpaqHIvDGdFE0eG+2mZlmMnUeDCBhQlbc7QMzFQYKTV94NfaebBO4PmNdADe1rq4WidSRZZbE7CzkX9IGENYnBTWY0hb2l0lGdGrJdGeWyV3ekg9WVaFMMumrekds96h3Cx7dGz2kWDzIai2iEXE/qoE+xpkyXAYZNV3-----END PKCS7-----
                  ">
                  <input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
                  <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
                  </form>

                </div>
              </li>
          </ul>
        </li>
        <!-- end social media dropdown -->

        <li class="divider-vertical"></li>

        <!-- search dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-search" style='opacity:0.9;'></i>
          </a>
          <ul class='dropdown-menu'>
            
                <li><a href='../index.html'>Table of Contents</a></li>
            
            <li><a href='/runestone/static/pythonds/genindex.html'>Book Index</a></li>
            <li class="divider"></li>
            <li id="scratch_ac_link"><a href="javascript:toggleScratchActivecode()">Scratch ActiveCode</a></li>
            <li class="divider"></li>
            <li style="width: 240px;">
              <form class="navbar-search" style="margin:10px;" action="../search.html" method="get">
                <div class="input-group">
                  <input type="text" class="form-control" name="q" placeholder="Search this book" />
                  <span class="input-group-btn">
                    <button class="btn btn-primary" style="margin:0;" type="submit">
                      <i class="glyphicon glyphicon-search"></i>
                    </button>
                  </span>
                </div><!-- /input-group -->
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
            </li>
          </ul>
        </li>
        <!-- end search dropdown -->

        <li class="divider-vertical"></li>

        <!-- user account dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-user" style="opacity:0.9;"></i>
          </a>
          <ul class="dropdown-menu user-menu">
            <li><span class='loggedinuser'></span></li>
            <li class="divider"></li>
            <li><a href='http://127.0.0.1:8000/runestone/admin/index'>Instructor's Page</a></li>
            <li class="divider"></li>
            <li><a href="http://127.0.0.1:8000/runestone/default/user/profile" id="profilelink">Edit Profile</a></li>
            <li><a href="http://127.0.0.1:8000/runestone/default/user/change_password" id="passwordlink">Change Password</a></li>
            <li><a href="http://127.0.0.1:8000/runestone/default/user/register" id="registerlink">Register</a></li>
            <li class='loginout'><a href='#'>Login</a></li> <!-- correct link populated by addNavbarLoginLink() -->
          </ul>
        </li>
        <!-- end user account dropdown -->

        <li class="divider-vertical"></li>

        <!-- help menu dropdown -->
        <li class="dropdown">
          <a class="dropdown-toggle" href="#" data-toggle="dropdown">
            <i class="glyphicon glyphicon-question-sign" style="opacity:0.9;"></i>
          </a>
          <ul class="dropdown-menu user-menu">
            <li><a href='/runestone/static/pythonds/navhelp.html'>Navigation Help</a></li>
            <li><a href='/runestone/static/overview/instructor.html'>Help for Instructors</a></li>
            <li class="divider"></li>
            <li><a href='http://runestoneinteractive.org'>About Runestone</a></li>
            <li><a href='https://github.com/bnmnetp/runestone/issues/new'>Report A Problem</a></li>
          </ul>
        </li>
        <!-- end help menu dropdown -->

        <li class="divider-vertical"></li>

      </ul>

      <ul class="nav navbar-nav">
        <li class="divider-vertical"></li>
        <!--
          <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"><ul>
<li><a class="reference internal" href="#">Хэширование</a><ul>
<li><a class="reference internal" href="#id2">Хэш-функции</a></li>
<li><a class="reference internal" href="#id3">Разрешение коллизий</a></li>
<li><a class="reference internal" href="#map">Реализация абстрактного типа данных <tt class="docutils literal"><span class="pre">Map</span></tt></a></li>
<li><a class="reference internal" href="#id4">Анализ хэширования</a></li>
</ul>
</li>
</ul>
</ul>
</li>
          <li class="divider-vertical"></li>
        
        
          
  <li id="relations-prev" title="Previous Chapter - Бинарный поиск" data-toggle="tooltip">
    <a href="TheBinarySearch.html" >
      <i class='glyphicon glyphicon-backward' style='opacity:0.9;'></i>
    </a>
  </li>
  
  <li id="relations-next" title='Next Chapter - Пузырьковая сортировка' data-toggle="tooltip" >
    <a href="TheBubbleSort.html" >
      <i class='glyphicon glyphicon-forward' style='opacity:0.9;'></i>
    </a>
  </li>
  <li class="divider-vertical"></li>

<script type="text/javascript">
  opts = {'placement':'bottom',
          'selector': '',
          'delay': { show: 100, hide: 50}
         };

  $('#relations-prev').tooltip(opts);
  $('#relations-next').tooltip(opts);
</script>
        -->
        
          <li></li>
        
      </ul>

    </div>
  </div>
</div>


<div class="container" id="continue-reading"></div>

<div class="container" id="main-content">
  
  <div class="section" id="id1">
<h1>Хэширование<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>В предыдущих разделах мы смогли усовершенствовать наши алгоритмы поиска, используя преимущества информации о том, где элементы хранятся относительно друг друга. Например, зная, что список упорядочен, мы можем осуществлять поиск за логарифмическое время, используя бинарный алгоритм. В этом разделе мы попытаемся пойти ещё на шаг дальше, построив такую структуру данных, в которой можно будет осуществлять поиск за время <span class="math">\(O(1)\)</span>. Эту концепцию называют <strong>хэшированием</strong>.</p>
<p>Для этого нам нужно знать больше, чем просто расположение элемента, когда мы ищем его в коллекции. Если каждый элемент находится там, где ему следует быть, то поиск может использовать только сравнения для обнаружения присутствия искомого. Однако, дальше мы увидим, что это, как правило, не единственный выход.</p>
<p><strong>Хэш-таблица</strong> - это коллекция элементов, которые сохраняются таким образом, чтобы позже их было легко найти. Каждая позиция в хэш-таблице () часто называемая <strong>слотом</strong>) может содержать собственно элемент и целое число, начинающееся с нуля. Например, у нас есть слот 0, слот 1, слот 2 и так далее. Первоначально хэш-таблица не содержит элементов, так что каждый из них пуст. Мы можем сделать реализацию хэш-таблицы, используя список, в котором каждый элемент инициализирован специальным значением Python <tt class="docutils literal"><span class="pre">None</span></tt>. <a class="reference internal" href="#fig-hashtable1"><em>Рисунок 4</em></a> демонстрирует хэш-таблицу размером <span class="math">\(m=11\)</span>. Другими словами, в ней есть <em>m</em> слотов, пронумерованных от 0 до 10.</p>
<div class="figure align-center" id="fig-hashtable1">
<img alt="../_images/hashtable.png" src="../_images/hashtable.png" />
</div>
<p>Рисунок 4: Хэш-таблица с 11 пустыми слотами</p>
<p>Связь между элементом и слотом, в который кладётся элемент, называется <strong>хэш-функцией</strong>. Она принимает любой элемент из коллекции и возвращает целое число из диапазона имён слотов (от 0 до <em>m-1</em>). Предположим, что у нас есть набор целых чисел 54, 26, 93, 17, 77 и 31. Наша первая хэш-функция, иногда называемая &#8220;методом остатков&#8221;, просто берёт элемент и далит его на размер таблицы, возвращая остаток в качестве хэш-значения (<span class="math">\(h(item)=item \% 11\)</span>). В <a class="reference internal" href="#tbl-hashvalues1"><em>таблице 4</em></a> представлены все хэш-значения чисел из нашего примера. Обратите внимание, что метод остатков (модульная арифметика) обычно представлен в некоторой форме во всех хэш-функциях, поскольку результат должен лежать в диапазоне имён слотов.</p>
<table border="1" class="docutils" id="tbl-hashvalues1">
<caption><strong>Таблица 4: Простая хэш-функция, использующая остатки</strong></caption>
<colgroup>
<col width="52%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Элемент</strong></th>
<th class="head"><strong>Хэш-значение</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>54</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>26</td>
<td>4</td>
</tr>
<tr class="row-even"><td>93</td>
<td>5</td>
</tr>
<tr class="row-odd"><td>17</td>
<td>6</td>
</tr>
<tr class="row-even"><td>77</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>31</td>
<td>9</td>
</tr>
</tbody>
</table>
<p>Поскольку хэш-значения могут быть посчитаны, мы можем вставить каждый элемент в хэш-таблицу на определённое место, как это показано на <a class="reference internal" href="#fig-hashtable2"><em>рисунке 5</em></a>. Обратите внимание, что теперь заняты 6 из 11 слотов. Это называется <strong>фактором загрузки</strong> и обычно обозначается <span class="math">\(\lambda = \frac {numberofitems}{tablesize}\)</span>. В этом примере <span class="math">\(\lambda = \frac {6}{11}\)</span>.</p>
<div class="figure align-center" id="fig-hashtable2">
<img alt="../_images/hashtable2.png" src="../_images/hashtable2.png" />
</div>
<p>Рисунок 5: Хэш-таблица с шестью элементами</p>
<p>Теперь, когда мы хотим найти элемент, мы просто используем хэш-функцию, чтобы вычислить имя слота элемента и затем проверить по таблице его наличие. Эта операция поиска имеет <span class="math">\(O(1)\)</span>, поскольку на вычисление хэш-значения требуется константное время, как и на переход по найденному индексу. Если всё находится там, где ему положено, то мы получаем алгоритм поиска за константное время.</p>
<p>Возможно, вы уже заметили, что такая техника работает только если каждый элемент отображается на уникальную позицию в хэш-таблице. Например, если следующим в нашей коллекции будет элемент 44, то он будет иметь хэш-значение 0 (<span class="math">\(44 \% 11 == 0\)</span>). А так как 77 тоже имеет хэш-значение 0, то у нас проблемы. В соответствии с хэш-функцией два или более элементов должны иметь один слот. Это называется <strong>коллизией</strong> (иногда &#8220;столкновением&#8221;). Очевидно, что коллизии создают проблемы для техники хэширования. Позднее мы обсудим их в деталях.</p>
<div class="section" id="id2">
<h2>Хэш-функции<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Для заданной коллекции элементов хэш-функция, связывающая каждый из них с уникальным слотом, называется <strong>идеальной хэш-функцией</strong>. Если мы знаем, что элемент коллекции никогда не будет меняться, то возможно создать идеальную хэш-функцию (см. упражнения, чтобы узнать о них больше). К сожалению, для произвольной коллекции элементов не существует систематического способа сконструировать идеальную хэш-функцию. К счастью, для эффективной работы она нам и не нужна.</p>
<p>Один из способов всегда иметь идеальную хэш-функцию состоит в увеличении размера хэш-таблицы таким образом, чтобы в ней могло быть размещено каждое из возможных значений элементов. Это гарантирует, что каждый элемент будет иметь уникальный слот. Хотя это практично для малого числа элементов, при возрастании их количества такой метод перестаёт быть осуществимым. Например, если элементы будут девятизначными номерами социального страхования, то этот метод потребует порядка миллиарда слотов. Если мы захотим всего лишь хранить данные для класса из 25 студентов, то мы потратим на это чудовищное количество памяти.</p>
<p>Наша цель: создать хэш-функцию, которая минимизировала бы количество коллизий, легко считалась и равномерно распределяла элементы в хэш-таблице. Существует несколько распространённых способов расширить простой метод остатков. Рассмотрим некоторые из них.</p>
<p><strong>Метод свёртки</strong> для создания хэш-функций начинает с деления элемента на кусочки одинаковой величины (последний из них может иметь отличающийся размер). Эти кусочки складываются вместе и дают результирующее хэш-значение. Например, если наш элемент - телефонный номер 436-555-4601, то мы можем взять цифры и рабить их на группы по два (43, 65, 55, 46, 01). После сложения <span class="math">\(43+65+55+46+01\)</span> мы получим 210. Если предположить, что хэш-таблица имеет 11 слотов, то нам нужно выполнить дополнительный шаг, поделив это число на 11 и взяв остаток. В данном случае <span class="math">\(210\ \%\ 11\)</span> равно 1, так что телефонный номер 436-555-4601 хэшируется в слот 1. Некоторые методы свёртки идут на шаг дальше и перед сложением переворачивают каждый из кусочков разбиения. Для примера выше мы бы получили <span class="math">\(43+56+55+64+01 = 219\)</span>, что даёт <span class="math">\(219\ \%\ 11 = 10\)</span>.</p>
<p>Другая числовая техника для создания хэш-функций называется <strong>методом средних квадратов</strong>. Сначала значение элемента возводится в квадрат, а затем из получившихся в результате цифр выделяется некоторая порция. Например, если элемент равен 44, то мы прежде вычислим <span class="math">\(44 ^{2} = 1,936\)</span>. Выделив две средние цифры (93) и выполнив шаг получения остатка, мы получим 5 (<span class="math">\(93\ \%\ 11\)</span>). <a class="reference internal" href="#tbl-hashvalues2"><em>Таблица 5</em></a> показывает элементы, к которым применили оба метода: остатков и средних квадратов. Убедитесь, что понимаете, как эти значения были получены.</p>
<p>Мы также можем создать хэш-функцию для символьных элементов (таких, как строки). Слово &#8220;cat&#8221; можно рассматривать, как последовательность кодов его букв.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">ord</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
<span class="go">99</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">ord</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="go">97</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">ord</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>
<span class="go">116</span>
</pre></div>
</div>
<p>Затем мы можем взять эти три кода, сложить их и спользовать метод остатков, чтобы получить хэш-значение (см. <a class="reference internal" href="#fig-stringhash"><em>рисунок 6</em></a>). <a class="reference internal" href="#lst-hashfunction1"><em>Листинг 1</em></a> демонстрирует функцию <tt class="docutils literal"><span class="pre">hash</span></tt>, принимающую строку и размер таблицы и возвращающую хэш-значение из диапазона от 0 до <tt class="docutils literal"><span class="pre">tablesize</span></tt>-1.</p>
<div class="figure align-center" id="fig-stringhash">
<img alt="../_images/stringhash.png" src="../_images/stringhash.png" />
</div>
<p>Рисунок 6: Хэширование строки с использованием кодов символов</p>
<p id="lst-hashfunction1"><strong>Листинг 1</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">hash</span><span class="p">(</span><span class="n">astring</span><span class="p">,</span> <span class="n">tablesize</span><span class="p">):</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">astring</span><span class="p">)):</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="nb">ord</span><span class="p">(</span><span class="n">astring</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>

    <span class="k">return</span> <span class="nb">sum</span><span class="o">%</span><span class="n">tablesize</span>
</pre></div>
</div>
<p>Интересное наблюдение: когда мы используем эту хэш-функцию, анаграммы всегда будут иметь одинаковое хэш-значение. Чтобы исправить это, следует использовать позицию символа в качестве веса. <a class="reference internal" href="#fig-stringhash2"><em>Рисунок 7</em></a> показывает один из вариантов использования позиционного значения в качестве весового фактора. Модификацию функции <tt class="docutils literal"><span class="pre">hash</span></tt> мы оставляем в качестве упражнения.</p>
<div class="figure align-center" id="fig-stringhash2">
<img alt="../_images/stringhash2.png" src="../_images/stringhash2.png" />
</div>
<p>Рисунок 7: Хэширование строки с использованием кодов символов и весов</p>
<p>Вы можете придумать другие числовые способы вычисления хэш-значений для элементов коллекции. Важно только помнить, эффекитвная хэш-функция не должна являться доминирующей частью процессов хранения и поиска. Если она слишком сложна, то требует много работы на вычисление имени слота. В этом случае проще было бы использовать последовательный или бинарный поиск, описанные выше. Таким образом, сама идея хэширования терпит поражение.</p>
</div>
<div class="section" id="id3">
<h2>Разрешение коллизий<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>Вернёмся к проблеме коллизий. Когда два элемента хэшируются в один слот, нам требуется систематический метод для размещения в хэш-таблице второго элемента. Этот процесс называется <strong>разрешением коллизии</strong>. Как мы утверждали ранее, если хэш-функция идеальна, то коллизии никогда не произойдёт. Однако, поскольку часто такое положение дел невозможно, разрешение коллизий становится важной частью хэширования.</p>
<p>Одним из методов разрешения коллизий является просмотр хэш-таблицы и поиск другого свободного слота для размещения в нём элемента, вызывающего коллизию. Простой способ сделать это - начать с оригинальной позиции хэш-значения и перемещаться по слотам определённым образом до тех пор, пока не будет найден пустой. Заметьте, что нам может понадобиться вернуться обратно к первому слоту (циклически), чтобы охватить хэш-таблицу целиком. Этот процесс разрешения коллизий называется <strong>открытой адресацией</strong>, поскольку пытается найти следующий свободный слот (или адрес) в хэш-таблице. Симстематически посещая каждый слот по одному разу, мы действуем в соответствии с техникой открытой адресации, называемой <strong>линейным пробированием</strong>.</p>
<p><a class="reference internal" href="#fig-linearprobing"><em>Рисунок 8</em></a> показывает расширенный набор целых элементов после применения простой хэш-функции метода остатков (54,26,93,17,77,31,44,55,20). В <a class="reference internal" href="#tbl-hashvalues1"><em>таблице 4</em></a> выше собраны хэш-значения оригинальных элементов. На <a class="reference internal" href="#fig-hashtable2"><em>рисунке 5</em></a> представлено первоначальные значения. Когда мы пытаемся поместить 44 в слот 0, возникает коллизия. При линейном пробировании мы последовательно - слот за слотом - просматриваем таблицу, до тех пор, пока не найдём открытую позицию. В данном случае это оказался слот 1.</p>
<p>В следующий раз 55, которое должно разместиться в слоте 0, будет положено в слот 2 - следующую незанятую позицию. Последнее значение 20 хэшируется в слот 9. Но поскольку он занят, мы делаем линейное пробирование. Мы посещаем слоты 10, 0, 1, 2 и наконец находим пустой слот на позиции 3.</p>
<div class="figure align-center" id="fig-linearprobing">
<img alt="../_images/linearprobing1.png" src="../_images/linearprobing1.png" />
</div>
<p>Рисунок 8: Разрешение коллизий путём линейного пробирования</p>
<p>Поскольку мы построили хэш-таблицу с помощью открытой адресации (или линейного пробирования), важно использовать тот же метод при поиске элемента. Предположим, мы хотим найти число 93. Вчисление его хэш-значения даст 5. Обнаружив в пятом слоте 93, мы вернём <tt class="docutils literal"><span class="pre">True</span></tt>. Но что если мы ищем 20? Теперь хэш-значение равно 9, а слот 9 содержит 31. Нельзя просто вернуть <tt class="docutils literal"><span class="pre">False</span></tt>, поскольку здесь могла быть коллизия. Так что мы вынуждены провести последвательный поиск, начиная с десятой позиции, который закончится, когда найдётся число 20 или пустой слот.</p>
<p>Недостатком линейного пробирования является его склонность к кластеризации: элементы в таблице группируются. Это означает, что если возникает много коллизий с одним хэш-значением, то окружающие его слоты при линейном пробировании будут заполнены. Это начнёт оказывать влияние на вставку других элементов, как мы наблюдали выше при попытке вставить в таблицу число 20. В итоге, кластер значений, хэшируемых в 0, должен быть пропущен, чтобы найти вакантное место. Этот кластер показан на <a class="reference internal" href="#fig-clustering"><em>рисунке 9</em></a>.</p>
<div class="figure align-center" id="fig-clustering">
<img alt="../_images/clustering.png" src="../_images/clustering.png" />
</div>
<p>Одним из способов иметь дело с кластеризацией является расширение линейного пробирования таким образом, чтобы вместо последовательного поиска следующего свободного места мы пропускали слоты, получая таким образом более равномерное распределение элементов, вызвавших коллизии. Потенциально это уменьшит возникающую кластеризацию. <a class="reference internal" href="#fig-linearprobing2"><em>Рисунок 10</em></a> показывает элементы после разрешения коллизий с использованием пробирования &#8220;плюс 3&#8221;. Это означает, что при возникновении коллизии, мы рассматриваем каждый третий слот до тех пор, пока не найдём пустой.</p>
<div class="figure align-center" id="fig-linearprobing2">
<img alt="../_images/linearprobing2.png" src="../_images/linearprobing2.png" />
</div>
<p>Общее название для такого процесса поиска другого слота после коллизии - <strong>повторное хэширование</strong>. С помощью простого линейного пробирования повторная хэш-функция выглядит как <span class="math">\(newhashvalue = rehash(oldhashvalue)\)</span>, где <span class="math">\(rehash(pos) = (pos + 1) \% sizeoftable\)</span>. Повторное хэширование &#8220;плюс 3&#8221; может быть определёно как <span class="math">\(rehash(pos) = (pos+3) \% sizeoftable\)</span>. В общем случае: <span class="math">\(rehash(pos) = (pos + skip) \% sizeoftable\)</span>. Важно отметить, что величина &#8220;пропуска&#8221; должен быть такой, чтобы в конце концов пройти по всем слотам таблицы. В противном случае часть таблицы окажется неиспользованной. Для обеспечения этого часто предполагается, что размер таблицы является простым числом. Вот почему в примере мы использовали 11.</p>
<p>Ещё одним вариантом линейного сканирования является <strong>квадратичное пробирование</strong>. Вместо использования константного значения &#8220;пропуска&#8221;, мы используем повторную хэш-функцию, которая инкрементирует хэш-значение на 1, 3, 5, 7, 9 и так далее. Это означает, что если первое хэш-значение равно <em>h</em>, то последующими будут <span class="math">\(h+1\)</span>,
<span class="math">\(h+4\)</span>, <span class="math">\(h+9\)</span>, <span class="math">\(h+16\)</span> и так далее. Другими словами, квадратичное пробирование использует пропуск, состоящий из следующих один за другим полных квадратов. <a class="reference internal" href="#fig-quadratic"><em>Рисунок 11</em></a> демонстрирует значения из нашего примера после использования этой методики.</p>
<div class="figure align-center" id="fig-quadratic">
<img alt="../_images/quadratic.png" src="../_images/quadratic.png" />
</div>
<p>Альтернативным методом решения проблемы коллизий является разрешение каждому слоту содержать ссылку на коллекцию (или цепочку) значений. <strong>Цепочки</strong> позволяют множеству элементов занимать одну и ту же позицию в хэш-таблице. Чем больше элементов хэшируются в одно место, тем сложнее найти элемент в коллекции. <a class="reference internal" href="#fig-chaining"><em>Рисунок 12</em></a> показывает, как элементы добавляются в хэш-таблицу с использованием цепочек для разрешения коллизий.</p>
<div class="figure align-center" id="fig-chaining">
<img alt="../_images/chaining.png" src="../_images/chaining.png" />
</div>
<p>Когда мы хотим найти элемент, мы используем хэш-функцию для генерации номера слота, в котором он должен размещаться. Поскольку каждый слот содержит коллекцию, мы используем различные техники поиска, чтобы определить, представлен ли он в ней. Преимуществом данного подхода является вероятность получить гораздо меньше элементов в каждом слоте, так что поиск будет более эффективным. Более подробный анализ мы проведём в конце этой главы.</p>
<div class="admonition- admonition">
<p class="first admonition-title">Самопроверка</p>

            <div id="HASH_1" class="alert alert-warning">
            sc-1-6: В хэш-таблице размером 13 какой индекс будет связан со следующими двумя ключами 27, 130?<form name="HASH_1_form" method="get" action="" onsubmit="return false;">
            <input type="radio" name="group1" value="a" id="HASH_1_opt_a" />
            <label for= "HASH_1_opt_a">  a) 1, 10</label><br />
            
            <input type="radio" name="group1" value="b" id="HASH_1_opt_b" />
            <label for= "HASH_1_opt_b">  b) 13, 0</label><br />
            
            <input type="radio" name="group1" value="c" id="HASH_1_opt_c" />
            <label for= "HASH_1_opt_c">  c) 1, 0</label><br />
            
            <input type="radio" name="group1" value="d" id="HASH_1_opt_d" />
            <label for= "HASH_1_opt_d">  d) 2, 3</label><br />
            

            <script>
            $(document).ready(function(){checkRadio('HASH_1');});
            </script>
            <button class='btn btn-success' name="do answer" onclick="checkMCMFStorage('HASH_1','c',['Будте внимательны, используйте оператор остатка, а не результат целочисленного деления.', 'Не делите на два, используйте оператор деления с остатком.', '27 % 13 \u003D\u003D 1 и 130 % 13 \u003D\u003D 0', 'Используйте оператор деления с остатком.'])">Check Me</button>
            <button class='btn btn-default' id="HASH_1_bcomp" disabled name="compare" onclick="compareAnswers('HASH_1');">Compare Me</button>
            </form><br />
            <div id="HASH_1_feedback">
            </div>
            </div>
            
            <div id="HASH_2" class="alert alert-warning">
            sc-1-7: Предположим, у вас есть следующий набор ключей для вставки в хэш-таблицу, содержащую ровно 11 значений: 113 , 117 , 97 , 100 , 114 , 108 , 116 , 105 , 99. Что из следующего лучше всего демонстрирует содержимое таблицы после вставки всех ключей с использованием линейного сканирования?<form name="HASH_2_form" method="get" action="" onsubmit="return false;">
            <input type="radio" name="group1" value="a" id="HASH_2_opt_a" />
            <label for= "HASH_2_opt_a">  a) 100, __, __, 113, 114, 105, 116, 117, 97, 108, 99</label><br />
            
            <input type="radio" name="group1" value="b" id="HASH_2_opt_b" />
            <label for= "HASH_2_opt_b">  b) 99, 100, __, 113, 114, __, 116, 117, 105, 97, 108</label><br />
            
            <input type="radio" name="group1" value="c" id="HASH_2_opt_c" />
            <label for= "HASH_2_opt_c">  c) 100, 113, 117, 97, 14, 108, 116, 105, 99, __, __</label><br />
            
            <input type="radio" name="group1" value="d" id="HASH_2_opt_d" />
            <label for= "HASH_2_opt_d">  d) 117, 114, 108, 116, 105, 99, __, __, 97, 100, 113</label><br />
            

            <script>
            $(document).ready(function(){checkRadio('HASH_2');});
            </script>
            <button class='btn btn-success' name="do answer" onclick="checkMCMFStorage('HASH_2','b',['Похоже, что вы использовали арифметику по модулю 2. Вам нужно использовать размер хэш\u002Dтаблицы в качестве модуля.', 'Использование арифметики для модуля 11 и линейного пробирования даст эти значения.', 'Похоже, вы использовали арифметику для модуля 10. Попробуйте арифметику для модуля размера таблицы.', 'Будте внимательны, используйте оператор остатка, а не результат целочисленного деления.'])">Check Me</button>
            <button class='btn btn-default' id="HASH_2_bcomp" disabled name="compare" onclick="compareAnswers('HASH_2');">Compare Me</button>
            </form><br />
            <div id="HASH_2_feedback">
            </div>
            </div>
            </div>
</div>
<div class="section" id="map">
<h2>Реализация абстрактного типа данных <tt class="docutils literal"><span class="pre">Map</span></tt><a class="headerlink" href="#map" title="Permalink to this headline">¶</a></h2>
<p>Одной из наиболее используемых коллекций Python являются словари. Напомним, что словарь - ассоциативный тип данных, в котором можно хранить пары ключ-значение. Ключи используются для поиска ассоциативных значений данных. Мы часто называем эту идею <strong>отображением</strong>.</p>
<p>Абстрактный тип данных <tt class="docutils literal"><span class="pre">Map</span></tt> можно определить следующим образом. Его структура - неупорядоченная коллекция ассоциаций между ключами и значениями. Все ключи уникальны, таким образом поддерживаются отношения &#8220;один к одному&#8221; между ключами и значениями. Операции для такого типа данных представлены ниже:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">Map()</span></tt> Создаёт новый пустой экземпляр типа. Возвращает пустую коллекцию отображений.</li>
<li><tt class="docutils literal"><span class="pre">put(key,</span> <span class="pre">val)</span></tt> Добавляет новую пару ключ-значение в отображение. Если такой ключ уже имеется, то заменяет старое значение новым.</li>
<li><tt class="docutils literal"><span class="pre">get(key)</span></tt> Принимает ключ, возвращает соответствующее ему значение из коллекции или <tt class="docutils literal"><span class="pre">None</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">del</span></tt> Удаляет пару ключ-значение из отображения, используя оператор вида <tt class="docutils literal"><span class="pre">del</span> <span class="pre">map[key]</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">len()</span></tt> Возвращает количество пар ключ-значение, хранящихся в коллекции.</li>
<li><tt class="docutils literal"><span class="pre">in</span></tt> Возвращает <tt class="docutils literal"><span class="pre">True</span></tt> для оператора вида <tt class="docutils literal"><span class="pre">key</span> <span class="pre">in</span> <span class="pre">map</span></tt>, если данный ключ есть в коллекции, или <tt class="docutils literal"><span class="pre">False</span></tt> в противном случае.</li>
</ul>
<p>Одним из болших преимуществ словарей является то, что, имея ключ, мы можем найти ассоциированное с ним значение очень быстро. Для обеспечения надлежащей скорости нам нужна реализация, поддерживающая эффективный поиск. Мы можем использовать список с последовательным или бинарным поиском, но правильнее будет воспользоваться хэш-таблицей, описанной выше, поскольку поиск элемента в ней может приближаться к производительности <span class="math">\(O(1)\)</span>.</p>
<p>В <a class="reference internal" href="#lst-hashtablecodeconstructor"><em>листинге 2</em></a> мы используем два списка, чтобы создать класс <tt class="docutils literal"><span class="pre">HashTable</span></tt>, реализующий абстрактный тип данных <tt class="docutils literal"><span class="pre">Map</span></tt>. Один список, называемый <tt class="docutils literal"><span class="pre">slots</span></tt>, будет содержать ключи элементов, а параллельный ему список <tt class="docutils literal"><span class="pre">data</span></tt> - значения данных. Когда мы находим ключ, на соответствующей позиции в списке с данными будет находиться связанное с ним значение. Мы будем работать со списком ключей, как с хэш-таблицей, используя идеи, представленные ранее. Обратите внимание, что первоначальный размер хэш-таблицы выбран равным 11. Хотя это число произвольно, важно, чтобы размер был простым числом. Это сделает алгоритм разрешения коллизий максимально эффективным.</p>
<p id="lst-hashtablecodeconstructor"><strong>Листинг 2</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">HashTable</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slots</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">hashfunction</span></tt> реализует простой метод остатков. В качестве техники разрешения коллизий используется линейное пробирование с функцией повторного хэширования &#8220;плюс 1&#8221;. Функция <tt class="docutils literal"><span class="pre">put</span></tt> (см. <a class="reference internal" href="#lst-hashtablecodestore"><em>листинг 3</em></a>) предполагает, что в конце-концов найдётся пустой слот, или такой ключ уже присутствует в <tt class="docutils literal"><span class="pre">self.slots</span></tt>. Она вычисляет оригинальное хэш-значение и, если слот не пуст, применяет функцию <tt class="docutils literal"><span class="pre">rehash</span></tt> до тех пор, пока не найдёт свободное место. Если непустой слот уже содержит ключ, старое значение данных будет заменено на новое.</p>
<p id="lst-hashtablecodestore"><strong>Листинг 3</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
  <span class="n">hashvalue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hashfunction</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slots</span><span class="p">))</span>

  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slots</span><span class="p">[</span><span class="n">hashvalue</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">slots</span><span class="p">[</span><span class="n">hashvalue</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">hashvalue</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slots</span><span class="p">[</span><span class="n">hashvalue</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">hashvalue</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>  <span class="c">#replace</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">nextslot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rehash</span><span class="p">(</span><span class="n">hashvalue</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slots</span><span class="p">))</span>
      <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">slots</span><span class="p">[</span><span class="n">nextslot</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> \
                      <span class="bp">self</span><span class="o">.</span><span class="n">slots</span><span class="p">[</span><span class="n">nextslot</span><span class="p">]</span> <span class="o">!=</span> <span class="n">key</span><span class="p">:</span>
        <span class="n">nextslot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rehash</span><span class="p">(</span><span class="n">nextslot</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slots</span><span class="p">))</span>

      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slots</span><span class="p">[</span><span class="n">nextslot</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slots</span><span class="p">[</span><span class="n">nextslot</span><span class="p">]</span><span class="o">=</span><span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">nextslot</span><span class="p">]</span><span class="o">=</span><span class="n">data</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">nextslot</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span> <span class="c">#replace</span>

<span class="k">def</span> <span class="nf">hashfunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">size</span><span class="p">):</span>
     <span class="k">return</span> <span class="n">key</span><span class="o">%</span><span class="n">size</span>

<span class="k">def</span> <span class="nf">rehash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">oldhash</span><span class="p">,</span><span class="n">size</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">oldhash</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="n">size</span>
</pre></div>
</div>
<p>Аналогично функция <tt class="docutils literal"><span class="pre">get</span></tt> (см. <a class="reference internal" href="#lst-hashtablecodesearch"><em>листинг 4</em></a>) начинает с вычисления начального хэш-значения. Если искомая величина не содержится в этом слоте, то используется <tt class="docutils literal"><span class="pre">rehash</span></tt> для определения следующей позиции. Обратите внимание: строка 15 гарантирует, что поиск закончится, проверяя не вернулись ли мы в начальный слот. Если такое происходит, значит все возможные слоты исчерпаны, и элемент в коллекции не представлен.</p>
<p>Кончный метод класса <tt class="docutils literal"><span class="pre">HashTable</span></tt> предоставляет для словарей дополнительный функционал. Мы перегружаем методы <tt class="docutils literal"><span class="pre">__getitem__</span></tt> и <tt class="docutils literal"><span class="pre">__setitem__</span></tt>, чтобы получать доступ к элементам с помощью <tt class="docutils literal"><span class="pre">[]</span></tt>. Это подразумевает, что созданному экземпляру <tt class="docutils literal"><span class="pre">HashTable</span></tt> будет доступен знакомый оператор индекса. Оставшиеся методы мы оставляем в качестве упражнения.</p>
<p id="lst-hashtablecodesearch"><strong>Листинг 4</strong></p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
  <span class="n">startslot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hashfunction</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slots</span><span class="p">))</span>

  <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>
  <span class="n">stop</span> <span class="o">=</span> <span class="bp">False</span>
  <span class="n">found</span> <span class="o">=</span> <span class="bp">False</span>
  <span class="n">position</span> <span class="o">=</span> <span class="n">startslot</span>
  <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">slots</span><span class="p">[</span><span class="n">position</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span>  \
                       <span class="ow">not</span> <span class="n">found</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">stop</span><span class="p">:</span>
     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slots</span><span class="p">[</span><span class="n">position</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
       <span class="n">found</span> <span class="o">=</span> <span class="bp">True</span>
       <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">position</span><span class="p">]</span>
     <span class="k">else</span><span class="p">:</span>
       <span class="n">position</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rehash</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slots</span><span class="p">))</span>
       <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="n">startslot</span><span class="p">:</span>
           <span class="n">stop</span> <span class="o">=</span> <span class="bp">True</span>
  <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Следующая сессия демонстрирует класс <tt class="docutils literal"><span class="pre">HashTable</span></tt> в действии. Сначала мы создаём хэш-таблицу и сохраняем в неё несколько элементов с целочисленными ключами и строковыми значениями данных.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">H</span><span class="o">=</span><span class="n">HashTable</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">H</span><span class="p">[</span><span class="mi">54</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;cat&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">H</span><span class="p">[</span><span class="mi">26</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;dog&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">H</span><span class="p">[</span><span class="mi">93</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;lion&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">H</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;tiger&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">H</span><span class="p">[</span><span class="mi">77</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;bird&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">H</span><span class="p">[</span><span class="mi">31</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;cow&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">H</span><span class="p">[</span><span class="mi">44</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;goat&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">H</span><span class="p">[</span><span class="mi">55</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;pig&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">H</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span><span class="o">=</span><span class="s">&quot;chicken&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">H</span><span class="o">.</span><span class="n">slots</span>
<span class="go">[77, 44, 55, 20, 26, 93, 17, None, None, 31, 54]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">H</span><span class="o">.</span><span class="n">data</span>
<span class="go">[&#39;bird&#39;, &#39;goat&#39;, &#39;pig&#39;, &#39;chicken&#39;, &#39;dog&#39;, &#39;lion&#39;,</span>
<span class="go">       &#39;tiger&#39;, None, None, &#39;cow&#39;, &#39;cat&#39;]</span>
</pre></div>
</div>
<p>Далее мы получаем доступ и изменяем некоторые из элементов в хэш-таблице. Обратите внимание, что значение с ключом 20 заменяется.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">H</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span>
<span class="go">&#39;chicken&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">H</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span>
<span class="go">&#39;tiger&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">H</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;duck&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">H</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span>
<span class="go">&#39;duck&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">H</span><span class="o">.</span><span class="n">data</span>
<span class="go">[&#39;bird&#39;, &#39;goat&#39;, &#39;pig&#39;, &#39;duck&#39;, &#39;dog&#39;, &#39;lion&#39;,</span>
<span class="go">       &#39;tiger&#39;, None, None, &#39;cow&#39;, &#39;cat&#39;]</span>
<span class="go">&gt;&gt; print(H[99])</span>
<span class="go">None</span>
</pre></div>
</div>
<p>Целиком пример хэш-таблицы можно увидеть в ActiveCode 1.</p>

<div id="cont"></div>
<div id="hashtablecomplete" lang="python" class="ac_section alert alert-warning" >

<div class="ac_actions">
<button class='btn btn-success' id="hashtablecomplete_runb">Run</button>
<button class="ac_opt btn btn-default" style="display: inline-block" id="hashtablecomplete_saveb" onclick="saveEditor('hashtablecomplete');">Save</button>
<button class="ac_opt btn btn-default" style="display: inline-block" id="hashtablecomplete_loadb" onclick="requestCode('hashtablecomplete');">Load</button>

<span class="ac_sep"></span>
<button class='btn btn-default' id="hashtablecomplete_showb" onclick="$('#hashtablecomplete_code_div').toggle();cm_editors['hashtablecomplete_code'].refresh();$('#hashtablecomplete_saveb').toggle();$('#hashtablecomplete_loadb').toggle()">Show/Hide Code</button>

</div>
<br/>
<div id="hashtablecomplete_code_div" style="display: none" class="ac_code_div">
<textarea cols="50" rows="12" id="hashtablecomplete_code" class="active_code", prefixcode="undefined" lang="python">
class HashTable:
    def __init__(self):
        self.size = 11
        self.slots = [None] * self.size
        self.data = [None] * self.size

    def put(self,key,data):
      hashvalue = self.hashfunction(key,len(self.slots))

      if self.slots[hashvalue] == None:
        self.slots[hashvalue] = key
        self.data[hashvalue] = data
      else:
        if self.slots[hashvalue] == key:
          self.data[hashvalue] = data  #replace
        else:
          nextslot = self.rehash(hashvalue,len(self.slots))
          while self.slots[nextslot] != None and \
                          self.slots[nextslot] != key:
            nextslot = self.rehash(nextslot,len(self.slots))

          if self.slots[nextslot] == None:
            self.slots[nextslot]=key
            self.data[nextslot]=data
          else:
            self.data[nextslot] = data #replace

    def hashfunction(self,key,size):
         return key%size

    def rehash(self,oldhash,size):
        return (oldhash+1)%size

    def get(self,key):
      startslot = self.hashfunction(key,len(self.slots))

      data = None
      stop = False
      found = False
      position = startslot
      while self.slots[position] != None and  \
                           not found and not stop:
         if self.slots[position] == key:
           found = True
           data = self.data[position]
         else:
           position=self.rehash(position,len(self.slots))
           if position == startslot:
               stop = True
      return data

    def __getitem__(self,key):
        return self.get(key)

    def __setitem__(self,key,data):
        self.put(key,data)

H=HashTable()
H[54]="cat"
H[26]="dog"
H[93]="lion"
H[17]="tiger"
H[77]="bird"
H[31]="cow"
H[44]="goat"
H[55]="pig"
H[20]="chicken"
print(H.slots)
print(H.data)

print(H[20])

print(H[17])
H[20]='duck'
print(H[20])
print(H[99])
</textarea>
</div>
<div class="ac_output">
<div style="text-align: center">
<canvas id="hashtablecomplete_canvas" class="ac-canvas" height="400" width="400" style="border-style: solid; display: none; text-align: center"></canvas>
</div>
<pre id="hashtablecomplete_suffix" style="display:none">
</pre><pre id="hashtablecomplete_pre" class="active_out">

</pre>

</div> 
<div class="clearfix"></div>
<p class="ac_caption"><span class="ac_caption_text">Пример хэш-таблицы целиком (hashtablecomplete)</span> </p>

<script>
if ('none' == 'none') {
    // a hack to preserve the inline-block display style. Toggle() will use display: block
    // (instead of inline-block) if the previous display style was 'none'
    $('#hashtablecomplete_saveb').toggle();
    $('#hashtablecomplete_loadb').toggle();
}
if ($("#hashtablecomplete_code_div").parents(".admonition").length == 0 && $("#hashtablecomplete_code_div").parents("#exercises").length == 0){
	if ($(window).width() > 975){
		$("#hashtablecomplete_code_div").offset({
			left: $("#hashtablecomplete .clearfix").offset().left
		});
	}
	$("#hashtablecomplete_runb").one("click", function(){
		$({})
		.queue(function (next) {
			if ($(window).width() > 975){
				$("#hashtablecomplete_code_div").animate({
					left: 40
				}, 500, next);
			}
			else{
				next();
			}
		})
		.queue(function (next) {
			$("#hashtablecomplete_runb").parent().siblings(".ac_output").show();
			runit('hashtablecomplete',this, undefined);
			$("#hashtablecomplete_runb").on("click", function(){
				runit('hashtablecomplete',this, undefined);
			});
		})
		
	});
}
else{
	console.log("inside new if")
	$("#hashtablecomplete_code_div").css({float : "none", marginLeft : "auto", marginRight : "auto"});
	$("#hashtablecomplete_runb").parent().siblings(".ac_output").show().css({float : "none", right : "0px"});
	$("#hashtablecomplete_runb").on("click", function(){
		console.log("button clicked");
		runit('hashtablecomplete',this, undefined);
	});
}
</script>

</div>

</div>
<div class="section" id="id4">
<h2>Анализ хэширования<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>Как мы заключили выше, в лучшем случае хэширование предоставляет технику поиска за константное время: <span class="math">\(O(1)\)</span>. Однако, из-за некоторого числа коллизий с количеством сравнений всё не так просто. Несмотря на то, что полный анализ хэширования выходит за рамки этого текста, мы можем определить несколько общеизвестных результатов, аппроксимирующих количество сравнений, необходимое для поиска элемента.</p>
<p>Наиболее важной частью информации, которую нам надо проанализировать при использовании хэш-таблицы, является фактор загрузки <span class="math">\(\lambda\)</span>. Концептуально, если <span class="math">\(\lambda\)</span> мало, то вероятность столкновений низкая. Это означает, что элементы вероятнее всего будут находиться в тех слотах, которым они принадлежат. Если же <span class="math">\(\lambda\)</span> велико, то это означает, что таблица близка к заполнению, т.е. будет возникать всё больше и больше коллизий. Следовательно, их разрешение будет более сложным, требовать больше сравнений для поиска свободного слота. В случае цепочек увеличение коллизий означает возрастание количества элементов в каждой из них.</p>
<p>Как и раньше, мы будем рассматривать результаты удачного и неудачного поиска. В первом случае с использованием открытой адресации с линейным пробированием среднее число сравнений приблизительно равно <span class="math">\(\frac{1}{2}\left(1+\frac{1}{1-\lambda}\right)\)</span>. Во втором - <span class="math">\(\frac{1}{2}\left(1+\left(\frac{1}{1-\lambda}\right)^2\right)\)</span>. Если мы используем цепочки, то среднее количество сравнений будет <span class="math">\(1 + \frac {\lambda}{2}\)</span> для удачного поиска и <span class="math">\(\lambda\)</span> для неудачного.</p>
</div>
</div>


  
      
  <li id="relations-prev" class="navLink" title='Previous Section - Бинарный поиск' data-toggle="tooltip">
    <a href="TheBinarySearch.html" >
      <i class='prevNav glyphicon glyphicon-chevron-left'></i>
    </a>
  </li>
  <a class="navLinkBg" id="navLinkBgLeft"  href="TheBinarySearch.html" ></a>
  
  <li id="relations-next" class="navLink" title='Next Section - Пузырьковая сортировка' data-toggle="tooltip" >
    <a href="TheBubbleSort.html" >
      <i id="relationsNextIcon" class='nextNav glyphicon glyphicon-chevron-right'></i>
    </a>
  </li>
  <a class="navLinkBg navLink" id="navLinkBgRight" href="TheBubbleSort.html" >Next Section - Пузырьковая сортировка</a>

<script type="text/javascript">

  $('#relations-prev').tooltip({'placement':'right', 'selector': '', 'delay': { show: 100, hide: 50}});
  $('#relations-next').tooltip({'placement':'left', 'selector': '', 'delay': { show: 100, hide: 50}});
  
</script>
  
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <span id='numuserspan'></span> readers online now | <span class='loggedinuser'></span> | <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2013 Brad Miller, David Ranum.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.
    </p>
  </div>
</footer>

<script type="text/javascript" charset="utf-8">
    $(document).ready(addUserToFooter);
    $(document).ready(addNavbarLoginLink);
    $(document).ready(createEditors);
    $(document).ready(getNumUsers);
    $(document).ready(getOnlineUsers);
    $(document).ready(createScratchActivecode());
    $(document).ready(styleUnittestResults());
</script>

<script type="text/javascript">
  // add the video play button overlay image
  $(".video-play-overlay").each(function() {
    $(this).css('background-image', "url(\'../_static/play_overlay_icon.png\')")
    });

  // This function is needed to allow the dropdown search bar to work;
  // The default behaviour is that the dropdown menu closes when something in
  // it (like the search bar) is clicked
  $(function() {
    // Fix input element click problem
    $('.dropdown input, .dropdown label').click(function(e) {
      e.stopPropagation();
      });
  });

  // style codelens buttons (doing it here because PyTutor is a submodule owned by someone else
  $(function() {
    $(".ExecutionVisualizer").each(function() {
      $(this).find("#jmpFirstInstr").addClass('btn btn-default');
      $(this).find("#jmpStepBack").addClass('btn btn-danger');
      $(this).find("#jmpStepFwd").addClass('btn btn-success');
      $(this).find("#jmpLastInstr").addClass('btn btn-default');
      });
  });

</script>


<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-32029811-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  </body>
</html>