..  Copyright (C)  Brad Miller, David Ranum, Jeffrey Elkner, Peter Wentworth, Allen B. Downey, Chris
    Meyers, and Dario Mitchell.  Permission is granted to copy, distribute
    and/or modify this document under the terms of the GNU Free Documentation
    License, Version 1.3 or any later version published by the Free Software
    Foundation; with Invariant Sections being Forward, Prefaces, and
    Contributor List, no Front-Cover Texts, and no Back-Cover Texts.  A copy of
    the license is included in the section entitled "GNU Free Documentation
    License".

Топологическая сортировка
-------------------------

В качестве демонстрации того, что учёные-информатики любую задачу могут свести к графу, давайте рассмотрим непростое задание напечь блинов. Рецепт очень прост: одно яйцо, одна чашка блинной смеси, одна столовая ложка растительного масла и :math:`3 \over 4` чашки молока. Чтобы нажарить блинов, вам нужно разогреть сковородку, смешать вместе все ингредиенты и выливать смесь по ложке на горячую сковороду. Когда блин начинает пузыриться, переверните его и дождитесь, пока нижняя сторона не станет золотистой. Перед тем, как приступить к поеданию блинов, полейте их сиропом. Весь процесс показан в виде графа на :ref:`рисунке 27 <fig_pancakes>`.

.. _fig_pancakes:

.. figure:: Figures/pancakes.png
   :align: center

   Рисунок 27: Этапы приготовления блинов

Трудность с приготовлением блинов состоит в необходимости определиться, что же делать первым. Как вы можете видеть на :ref:`рисунке 27 <fig_pancakes>` , начинать можно с разогрева сковороды или добавления любого ингредиента в блинную смесь. Чтобы помочь нам определиться с порядком шагов для выпечки блинов, мы применим алгоритм на графах под названием **топологическая сортировка**.

Топологическая сортировка берёт направленный ацикличный граф и выдаёт такой линейный порядок всех его вершин, что если граф :math:`G` содержит ребро :math:`(v,w)`, то вершина :math:`v` идёт перед вершиной :math:`w`. Направленный ацикличный граф используется во многих приложениях для указания приоритета событий. Приготовление блинов всего лишь один пример; к другим же можно отнести план проекта разработки программного обеспечения, приоритет графики для оптимизации запросов к базе данных и перемножение матриц.

Топологическя сортировка - простая, но полезная адаптация поиска в глубину. Её алгоритм следующий:

#. Вызвать ``dfs(g)`` для некоего графа ``g``. Основной причиной, по которой мы используем поиск в глубину, является необходимость подсчёта "времён" выхода для каждой из вершин.

#. Сохранить вершины в списке в убывающем порядке их "времён" выхода.

#. Вернуть упорядоченный список в качестве результата топологической сортировки.

На :ref:`рисунке 28 <fig_pancakesDFS>` показан лес поиска в глубину, сконструированный ``dfs`` по графу приготовления блинов из :ref:`рисунка 26 <fig_pancakes>`.

.. _fig_pancakesDFS:

.. figure:: Figures/pancakesDFS.png
   :align: center

   Рисунок 28: Результат поиска в глубину по блинному графу

Наконец, на :ref:`рисунке 29 <fig_pancakesTS>` показаны результаты применения алгоритма топологической сортировки к нашему графу. Теперь все неоднозначности благополучно удалены, и мы знаем точный порядок этапов приготовления блинов.

.. _fig_pancakesTS:

.. figure:: Figures/pancakesTS.png
   :align: center

   Рисунок 29: Результат топологической сортировки направленного ацикличного графа
